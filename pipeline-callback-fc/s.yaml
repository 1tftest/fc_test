edition: 3.0.0
name: pipeline-callback-fc
access: "default"

vars:
  # 基础配置变量
  region: ${env(FC_REGION, "cn-beijing")}
  serviceName: ${env(FC_NAME, "simple-python-function")}
  memorySize: ${env(FC_MEMORY_SIZE, "512")}
  timeout: ${env(FC_TIMEOUT, "60")}
  
  # 函数配置变量
  functionName: "callback-handler"
  runtime: "python3.9"
  handler: "index.handler"
  codePath: "./code"
  
  # 高级配置变量
  cpu: 0.35
  diskSize: 512
  internetAccess: true
  resourceGroupId: "rg-acfmzg7sd6igwsi"
  disableOndemand: false
  instanceConcurrency: 1

resources:
  fcDemo:
    component: fc3
    props:
      # 基础配置
      region: ${vars.region}
      functionName: ${vars.functionName}-${env(GITHUB_REF_NAME, "dev")}
      runtime: ${vars.runtime}
      handler: ${vars.handler}
      code: ${vars.codePath}
      
      # 资源规格
      memorySize: ${vars.memorySize}
      timeout: ${vars.timeout}
      cpu: ${vars.cpu}
      diskSize: ${vars.diskSize}
      
      # 网络与权限
      internetAccess: ${vars.internetAccess}
      resourceGroupId: ${vars.resourceGroupId}
      disableOndemand: ${vars.disableOndemand}
      role: ''
      
      # 描述信息
      description: "Pipeline callback function for ${env(GITHUB_REF_NAME, 'dev')} environment"
      
      # 异步配置
      asyncInvokeConfig:
        asyncTask: true
        maxAsyncEventAgeInSeconds: 86400
        maxAsyncRetryAttempts: 3
      
      # HTTP 触发器
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
