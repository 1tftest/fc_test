edition: 3.0.0
name: pipeline-callback-fc
access: "default"

vars:
  region: ${env(FC_REGION)}
  serviceName: ${env(FC_NAME)}
  memorySize: ${env(FC_MEMORY_SIZE, 128)}
  timeout: ${env(FC_TIMEOUT, 30)}
  internetAccess: ${env(FC_INTERNET_ACCESS, true)}

resources:
  function:
    component: fc3
    props:
      region: ${vars.region}
      service:
        name: ${vars.serviceName}
        description: "Pipeline Callback Function"
      function:
        name: callback-handler
        description: "Handle pipeline callback requests"
        runtime: python3.9
        code: ./
        handler: index.handler
        memorySize: ${vars.memorySize}
        timeout: ${vars.timeout}
        instanceConcurrency: 1
        environmentVariables:
          STAGE: ${env(GITHUB_REF_NAME, 'dev')}
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
