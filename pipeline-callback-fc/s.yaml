edition: 1.0.0
name: pipeline-callback-fc
access: "default"

vars:
  region: ${env(FC_REGION, "cn-beijing")}
  serviceName: ${env(FC_SERVICE_NAME, "pipeline-callback-service")}
  functionName: ${env(FC_FUNCTION_NAME, "callback-handler")}
  memorySize: ${env(FC_MEMORY_SIZE, "128")}
  timeout: ${env(FC_TIMEOUT, "30")}

resources:
  function:
    component: fc3
    props:
      region: ${vars.region}
      service:
        name: ${vars.serviceName}
      function:
        name: ${vars.functionName}
        description: "Pipeline callback function"
        runtime: python3.9
        code: ./code
        handler: index.handler
        memorySize: ${vars.memorySize}
        timeout: ${vars.timeout}
        instanceConcurrency: 1
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
