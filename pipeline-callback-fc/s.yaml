edition: 3.0.0
name: pipeline-callback-fc
access: "default"

vars:
  # 使用带引号的默认值，确保环境变量不存在时也能正常工作
  region: ${env(FC_REGION, "cn-beijing")}
  serviceName: ${env(FC_NAME, "simple-python-function")}
  memorySize: ${env(FC_MEMORY_SIZE, "128")}
  timeout: ${env(FC_TIMEOUT, "30")}
  internetAccess: ${env(FC_INTERNET_ACCESS, "true")}

resources:
  function:
    component: fc3
    props:
      region: ${vars.region}
      service:
        name: ${vars.serviceName}
        description: "Pipeline Callback Function"
      function:
        name: callback-handler
        description: "Handle pipeline callback requests"
        runtime: python3.9
        code: ./code
        handler: index.handler
        memorySize: ${vars.memorySize}
        timeout: ${vars.timeout}
        instanceConcurrency: 1
        environmentVariables:
          STAGE: ${env(GITHUB_REF_NAME, "dev")}
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
